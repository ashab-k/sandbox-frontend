"use client";

import { formatDate } from "@/lib/utils/formatDate";
import { Shield, AlertTriangle, FileWarning, CheckCircle } from "lucide-react";

interface MalwareAnalysisHeaderProps {
  fileInfo: {
    sha256: string;
    md5: string;
    sha1: string;
    size: number;
  };
  date: number;
  stats: {
    malicious: number;
    suspicious: number;
    undetected: number;
    harmless: number;
    timeout: number;
    "confirmed-timeout": number;
    failure: number;
    "type-unsupported": number;
  };
}

export function MalwareAnalysisHeader({
  fileInfo,
  date,
  stats,
}: MalwareAnalysisHeaderProps) {
  const totalScans = Object.values(stats).reduce((acc, val) => acc + val, 0);
  const detectionRate = Math.round((stats.malicious / totalScans) * 100);

  const getDetectionColor = (rate: number) => {
    if (rate >= 70) return "text-red-500";
    if (rate >= 30) return "text-yellow-500";
    return "text-green-500";
  };

  return (
    <div className="bg-card rounded-lg shadow-md p-6 mb-6">
      <div className="flex items-center justify-between mb-4">
        <div className="flex items-center gap-2">
          <Shield className="h-6 w-6 text-primary" />
          <h1 className="text-2xl font-bold">Malware Analysis Report</h1>
        </div>
        <div className="text-sm text-muted-foreground">
          Analyzed on: {formatDate(date)}
        </div>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
        <div className="space-y-2">
          <div className="flex items-center gap-2">
            <span className="text-sm font-medium text-muted-foreground">
              SHA256:
            </span>
            <span className="text-sm font-mono bg-muted px-2 py-1 rounded">
              {fileInfo.sha256}
            </span>
          </div>
          <div className="flex items-center gap-2">
            <span className="text-sm font-medium text-muted-foreground">
              MD5:
            </span>
            <span className="text-sm font-mono bg-muted px-2 py-1 rounded">
              {fileInfo.md5}
            </span>
          </div>
          <div className="flex items-center gap-2">
            <span className="text-sm font-medium text-muted-foreground">
              SHA1:
            </span>
            <span className="text-sm font-mono bg-muted px-2 py-1 rounded">
              {fileInfo.sha1}
            </span>
          </div>
          <div className="flex items-center gap-2">
            <span className="text-sm font-medium text-muted-foreground">
              Size:
            </span>
            <span className="text-sm">
              {fileInfo.size.toLocaleString()} bytes
            </span>
          </div>
        </div>

        <div className="flex flex-col justify-center">
          <div className="flex items-center justify-between mb-2">
            <span className="text-sm font-medium">Detection Rate:</span>
            <span
              className={`text-lg font-bold ${getDetectionColor(
                detectionRate
              )}`}
            >
              {detectionRate}%
            </span>
          </div>

          <div className="h-3 bg-muted rounded-full overflow-hidden mb-4">
            <div
              className={`h-full ${getDetectionColor(detectionRate).replace(
                "text-",
                "bg-"
              )}`}
              style={{ width: `${detectionRate}%` }}
            />
          </div>

          <div className="grid grid-cols-2 gap-2">
            <div className="flex items-center gap-2">
              <AlertTriangle className="h-4 w-4 text-red-500" />
              <span className="text-sm">
                Malicious: <strong>{stats.malicious}</strong>
              </span>
            </div>
            <div className="flex items-center gap-2">
              <FileWarning className="h-4 w-4 text-yellow-500" />
              <span className="text-sm">
                Suspicious: <strong>{stats.suspicious}</strong>
              </span>
            </div>
            <div className="flex items-center gap-2">
              <CheckCircle className="h-4 w-4 text-green-500" />
              <span className="text-sm">
                Clean: <strong>{stats.undetected + stats.harmless}</strong>
              </span>
            </div>
            <div className="flex items-center gap-2">
              <Shield className="h-4 w-4 text-gray-500" />
              <span className="text-sm">
                Total Scans: <strong>{totalScans}</strong>
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}
